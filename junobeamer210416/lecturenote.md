1. Yiyang Wu and I will introduce some waveform analysis methods which some of you may expected, and maybe additionally, a prospect of event reconstruction methods based on these algorithms. 
2. Particle events happen inside the liquid scintillator detector, which leads to lights, in other words, photons detected by PMTs. 
3. Extracting the timing and number of hit photons will provide detailed information of the light transmit process in the detector and more explicit model parameters in the time profile. These precise analysis results will finally enhance the performance of event reconstruction, particle identification, and definition of fiducial volume. 
4. Now, I introduce the simulation setup. Because the correlation between PMTs during waveform analysis is not important, we did not use a full event simulation in JUNO detector. Instead, a toy Monte Carlo is developed. The time profile of LS is treated as a convolution between Gaussian distribution with STD sigma and Exponential distribution with decay time tau. 
5. The Single PE response of the PMT is the same as Daya Bay. Single PE response will not influence waveform analysis significantly. The charge of a Single PE is subject to Normal distribution. 
6. Here is the data input waveform and output time and charge. The perfect waveform analysis result will be identical to toyMC result, which described by tilde phi. The total number of PE, NPE, in a waveform is subject to a Poisson distribution with expectation mu. The waveform is pure voltage fluctuation caused by PE and electronic noise, epsilon. 
7. Next, we define three kinds of evaluation criteria. 
8. The first is Residual Sum Square which measures the difference between original waveform and reconstructed waveform derived from analysis PE information. But we can see from the figure that RSS is not sensitive to timing. 
9. The second is Wasserstein Distance. Wasserstein Distance was introduced by Aiqiang Zhang 1 year ago. We can understand W-distance between phi hat and phi tilde as the minimal effort to transport mass from distributions phi hat and phi tilde. In numerical calculation, when p=1, W-distance is always called the earth mover's distance.  
10. The third one is Kullback-Leibler Divergence, KL-Divergence. As timing resolution is somehow important for subsequent analysis, we implement another parameter t0 which means the translation time of the time profile. We can prove that the KLD between phi hat and phi is proportional to the formula defined here. t hat is the reconstructed t0. And the big delta, which equals to t hat minus t0 will tell us how good the timing resolution is. 
11. Next, I will list three kinds of waveform analysis methods. 
12. Fourier Deconvolution. In frequency space, a waveform is PE phi and Single PE response, plus noise. So we can calculate the quotient of waveform and Single PE response to get PE phi. One demonstration here
13. Lucy Direct Deconvolution. It has also been introduced by Aiqiang Zhang one year ago. It is an iteration process that grantee that the charge in phi is always positive, unlike Fourier Deconvolution. 
14. We also built a CNN to do waveform analysis. The model here shows the structure of the network. Note that CNN uses W-distance as its loss. It is fast based on GPU, but has some disadvantages we will see later. 
15. Here, I introduce you Fast Bayesian Matching Pursuit. FBMP is a sparse regression algorithm, which origins from the field of signal processing. 
16. First, the model of FBMP. First, we divide the time window into time bins whose length is N. Each time bin can have 1 PE. As long as the bin width is small, the timing resolution will be retained. There is a model vector z that contains only 0 and 1. When zi is 0, the corresponding charge of PE in time bin ti will be 0, otherwise it may not be zero. The waveform is charge vector q multiplied by VPE, plus noise. This process is equivalent to tilde phi convoluting with Single PE, and merely time is digitized. Waveform and charge under a certain z are all Normal distribution. But we can see that model vector z has N power of 2 possible values. This disallows us from traverse in the z space. 
17. But we may see that most z can be ignored because most z does not correspond to the waveform. If we only consider the model vector z with a relatively large posterior probability, the calculation effort will be reduced. 
18. So a model selection metric log... is derived to evaluate which z shall be considered. 
19. And the final result of FBMP is the time vector, several models, and their charge vectors. Most importantly, the posterior probability of each model. In commonly used fitting mothers such as MLE, the posterior distribution is approximated into delta function or normal distribution. But FBMP gives us the Bayesian results and provides an opportunity for subsequent Bayesian analysis! 
20. Here is the demonstration of the FBMP result. The residual wave is small. 
21. We compared the W-distance and RSS of these methods. With a dataset of 10,000 waveforms whose parameters are..., we can see the FBMP and CNN are good at W-distance and RSS. But when we look at the posterior distribution of charge result, we can see that when the truth distribution of charge is normal, only FBMP can retain the distribution, which means every charge in FBMP method can be regarded as one PE, while other methods can not work due to these fragments of charge. 