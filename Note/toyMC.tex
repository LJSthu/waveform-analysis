\section{Towards Timing Resolution} % (fold)
\label{sec:toyMC}

\subsection{PMT waveform}

The incident particle, no matter we welcome or not, reacts with the material and deposit energy in the detector. During the de-excitation process, an indeterminate number of photons are emitted from the vertex of event and the trajectory of the incident particle. Some of these photons are collected by the PMTs. 

Typical PMT response includes several individual processes. First, single photon hits on the surface of PMT and transmission happens in the glass window and photoelectron (PE) conversion happens on photocathode. Then PE is collected by the first dynode. Finally amplification of electrons between dynodes provide measurable electrical signal. So a single incoming photon has a certain probability to be observed via PMT voltage (see figure~\ref{fig:spe}), which is a Bernoulli process. But if the hittime of photons is very short, shorter the the data acquisition (DAQ) window, the PE's voltage response will pile-up (see figure~\ref{fig:pile}) and discrimination of these PE will be difficult, as well as the waveform analysis. Pile-up will significantly worsen timing resolution. 

\begin{figure}[H]
\begin{minipage}[b]{.5\textwidth}
\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/spe.pgf}}
    \caption{\label{fig:spe} SPE response of PMT}
\end{figure}
\end{minipage}
\begin{minipage}[b]{.5\textwidth}
\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/wave.pgf}}
    \caption{\label{fig:pile} Pile-up in PMT waveform}
\end{figure}
\end{minipage}
\end{figure}

The data acquisition system will digitalize the time and voltage of recorded PMT output. Most of the time, when handling PMT waveform, we record the time of first PE according to threshold of voltage, $v_{th}$, and total charge in a DAQ window. The voltage which is higher than a certain threshold is assumed to be the consequence of photonelectron. Total charge is the integration of the waveform. Single photonelectron (SPE) induced charge can be a wide distribution, rather than a single value (see figure~\ref{fig:charge}). In these practical scenarios, one waveform is converted to a pair of numbers. More detailed information of the waveform was lost. 

\begin{minipage}[b]{1.\textwidth}
\begin{figure}[H]
    \centering
    \scalebox{0.4}{\input{figures/chargehist.pgf}}
    \caption{\label{fig:charge} Distribution of Charge}
\end{figure}
\end{minipage}

Here we defined the time of waveform, $t_{w}$ is discrete value in a DAQ window and the total number of PE's hittime in a DAQ window, $N_{pe}$ is equivalent to the number of PE recorded within a DAQ window. 

\subsection{toy Monte Carlo}

Currently there are two successful detector materials: water(heavy water) and liquid scintillator. The time profile of the scintillation light is always described as several components with different decay time and Cherenkov light is always described as $\delta$ function\cite{ludhova_particle_2020}. 

In toy MC, we describe the light transmit process using a hypothetical parameterized time profile model. We assume the time profile of the liquid scintillator is an exponential function convoluted by a gaussian function\cite{li_separation_2016} caused by the transit time spread of PMT, with the form in the formula \eqref{eq:time-pro}. 

\begin{equation}
    f(t) = \frac{1}{\tau}e^{-\frac{t - t_{0}}{\tau}} \otimes \mathcal{N}(\sigma)
    \label{eq:time-pro}
\end{equation}

In this formula, $t_{0}$ is the starting time of time profile which is account for the unknown beginning time of light emission. 

The total number of PE in a DAQ window (in a single waveform), $N_{pe}$, is sampled from a Truncated Poisson distribution($N_{pe}=0$ samples are abandoned) with expectation $\mu$. The hittime $t_{t}$ of each PE is sampled from the time profile $f(t)$ of the liquid scintillator. The charge of each PE is sampled from parameterized calibration result, which can be described as truncated normal distribution with probability distribution function. The typical combination of decay time ($\tau$) and transit time spread ($\sigma$) are listed in figure (see figure~\ref{fig:reso-diff}). For every PE expectation $\mu$, a sample set (size $N=10,000$) is generated to estimate the timing resolution $\delta$, which is the residual ($\Delta t_{0}$) distribution spread. 

\begin{equation}
    f(q) = A\cdot\mathcal{N}(\mu_{q},\sigma_{q}),\,(q>0)
    \label{eq:truncated}
\end{equation}

We used Maximum Likelihood Estimation (MLE) to estimate $t_{0}$ in formula\eqref{eq:time-pro}, which is the rise time of the time profile. The result of the toy MC shows in figure~\ref{fig:reso-diff}, where $\delta_{1st}$ and $\delta_{all}$ are timing resolution when using the first PE and all PE, respectively. Error bars are too thin to be seen. It is distinct that the timing resolution is smaller when reconstructing rise time using all PE. 

\begin{figure}[H]
    \centering
    \scalebox{0.7}{\input{figures/vs-deltadiv.pgf}}
    \caption{\label{fig:reso-diff} Timing resolution improved of waveform analysis}
\end{figure}

Before taking deep look into the methods, input and output need to be defined. A Geant4\cite{agostinelli_geant4simulation_2003}-based simulation package simulated events in the 1-ton detector\cite{wang_design_2017}. After collected, all data but PMT response is discarded. The input for waveform analysis is pedestal subtracted PMT waveform (see figure~\ref{fig:input}), and the output is the $q_{r}$ or $n_{r}$ sequence (see figure~\ref{fig:output}). 

\begin{figure}[H]
\begin{minipage}[b]{.5\textwidth}
\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/wave.pgf}}
    \caption{\label{fig:input} Data Input}
\end{figure}
\end{minipage}
\begin{minipage}[b]{.5\textwidth}
\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/charge.pgf}}
    \caption{\label{fig:output} Data Output}
\end{figure}
\end{minipage}
\end{figure}

The histogram of $N_{pe}$ and data structure show in figure (see figure~\ref{fig:penum}). 

\begin{figure}[H]
    \centering
    \scalebox{0.4}{\input{figures/pepos.pgf}}
    \caption{\label{fig:penum} $N_{pos}$ Histogram}
\end{figure}

The intention this work is extracting information of all hits in 1 DAQ window including $t$ \& reconstructed charge, $q_{r}(t)$. 

% section Towards Timing Resolution (end)