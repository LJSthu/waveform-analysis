\section{Summary and discussion}
\label{sec:discussion}

\subsection{Efficiency}

Table~\ref{tab:efficiency} gives the efficiency of four performant methods on our simulation datasets. The CNN on GPU is the fastest. The number of iteration for LucyDDM and gradient descent, as well as $t'_i$ sampling frequency of FBMP can be decreased to trade for speed. The time consumed by FBMP contains the initialization time of a LucyDDM pre-conditioner. 

\begin{table}[H]
    \centering
    \caption{\label{tab:efficiency} Reconstruction Efficiency.}
    \begin{tabular}{cc}
        \hline
        & Performance/$10^{5}$Waveform \\
        \hline
        CNN & 187.8s (GPU)\tablefootnote{one graphics card of NVIDIA\textsuperscript{\textregistered} A100.} \\
        Gradient Descent & 552.9s (CPU)\tablefootnote{100 CPU cores of AMD EYPC\texttrademark\ 7742} \\
        LucyDDM & 540.0s (CPU) \\
        FBMP & 2959.4s (CPU) \\
        \hline
    \end{tabular}
\end{table}

\subsection{Posterior charge distribution}

\begin{figure}[H]
    \centering
    \resizebox{0.6\textwidth}{!}{\input{figures/recchargehist.pgf}}
    \caption{\label{fig:recchargehist} $\hat{q}_i$ distribution with $\mu=4, \tau_l=\SI{20}{ns}$, and $\sigma_l=\SI{5}{ns}$.}
\end{figure}

Figure~\ref{fig:recchargehist} shows distribution of charge reconstruction result, $\hat{q}_i$, with $\mu=4, \tau_l=20\mathrm{ns}$, and $\sigma_l=5\mathrm{ns}$. 

The steep edge near 0 in LucyDDM distributions results from the threshold of the original $\hat{q}_i$. As we can see in figure~\ref{fig:recchargehist}, the charge distribution of LucyDDM, Fitting, and CNN are severely distorted, while the charge distribution of FBMP partly retains the shape of the original (or prior) distribution of charge. 

During optimization of Wasserstein distance between $\hat{\phi}(t)$ and $\tilde{\phi}(t)$ (e.g., CNN) or RSS between reconstructed wave $\hat{w}(t)$ and the original wave $w(t)$ (e.g., Fitting), the total number of hit time, which is the degree of freedom (DOF) of parameters, is a constant. So many $\hat{q}_i$'s turn out to be fragment values. The reduction of DOF before estimation of parameters in FBMP gives relatively good results in sparsity, though it is still noticeable that the slight skewness of charge distribution of FBMP persists. 

\subsection{Time resolution}
\label{subsec:timeresolution}

% Likelihood

The time resolution using these methods' results (time $\bm{\hat{t}}$ and charge $\bm{\hat{q}}$) are computed and collected. The $t_{0}$ reconstruction process is MLE by equation~\eqref{eq:pseudo} except FBMP, where $q_{i}$ is the charge in each time bin $t_{i}$ rather than the number of PE. For FBMP, equation~\eqref{eq:bayesianinter} is the likelihood to estimate both $t_{0}$ and $\mu$ (instead of complete uncertainty propagation, we may use the maximum posterior PE model with less accuracy). The comparison between time resolution using all PEs and the four methods is shown in figure~\ref{fig:deltamethods}, where error bars show 5 to 95 percentile confidential intervals. 

\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/vs-deltamethodsdiv.pgf}}
    \caption{\label{fig:deltamethods} Time reconstruction ratio of resolution $\sigma/\sigma_{\mathrm{ALL}}$ of methods}
\end{figure}

In figure~\ref{fig:deltamethods}, all 4 methods (LucyDDM, Fitting, CNN, FBMP) provide better time resolution than only using the first PE during construction, comparing to figure~\ref{fig:reso-diff}. 

\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/vs-bias.pgf}}
    \caption{\label{fig:biasmethods} Time reconstruction bias of methods}
\end{figure}

From figure~\ref{fig:deltamethods}, we can see that the $t_0$ estimation biases for the four methods are all similar to those based on all PEs. The considerable bias for the datasets with $\tau_l=\SI{20}{ns}$, and $\sigma_l=\SI{5}{ns}$ when $\mu$ is small is intrinsic. 

% Time bin

The reconstruction results of hit time, $\bm{\hat{t}}$, are discrete values (time bin edges in a DAQ window). Obtaining continuous values of $\bm{\hat{t}}$ may result in better analysis results. The results in the study show that when using refined time bins, the time resolution, the sparsity of reconstructed PEs, and all figures of merits (Wasserstein distance and RSS) are better; however, a lost efficiency. 

\subsection{Charge resolution}
\label{subsec:chargereconstruction}

Integration estimation (footnoted as $\mathrm{int}$) with $\hat{\mu}=\int w(t)\mathrm{d}t$ is deteriorated by the randomization process, such as charge distribution and Gaussian white noise in section~\ref{subsec:spe}. 

Considering that the energy response is a multiplier in the detector and the existing $\hat{\mu}$ bias, which we discuss below, the charge resolution is defined on $\log{\hat{\mu}}$. A perfect $\mu$ estimation of a waveform is that $\hat{\mu}_\mathrm{ALL}=N_\mathrm{PE}$. The corresponding resolution $\sigma_{\log\mu}$ is the lower limit of charge reconstruction. 

Figure~\ref{fig:biasmu} shows the bias of $\log\hat{\mu}$ of all four methods, where $\mathrm{FBMP}$ corresponds to $\hat{\mu}$ defined in equation~\eqref{eq:bayesianinter}, and for the other three methods (LucyDDM, Fitting, CNN), $\hat{\mu}$ is the sum of $\hat{\bm{q}}$. As $\log\hat{\mu}$ is unfavorably low when $\hat{\mu}$ is near 0 due to the lower long tail of charge distribution, the bias of integration is less than zero if $\mu$ is small. A detailed explanation for the bias of FBMP is in appendix~\ref{sec:mubias}, and briefly it comes from the degeneracy of reconstruction results and the non-ergodic approximation of FBMP. 

\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/vs-biasmut.pgf}}
    \caption{\label{fig:biasmu} Charge reconstruction bias of methods}
\end{figure}

Figure~\ref{fig:deltamu} shows the charge resolution of both integration and the four methods. While estimating the PE number $\hat{\bm{z}}$ in each time bin $\hat{\bm{t}}$ with model selection, $\hat{\mu}$ of FBMP is not critically affected by the charge distribution, which gives a better charge resolution especially when $\mu$ is small. 

\begin{figure}[H]
    \centering
    \resizebox{\textwidth}{!}{\input{figures/vs-deltamethodsdivmu.pgf}}
    \caption{\label{fig:deltamu} Charge reconstruction ratio of resolution $\sigma/\sigma_{\log\mu}$ of methods}
\end{figure}

In figure~\ref{fig:deltamethods}, FBMP shows convincing resolution as expected. The other three methods (LucyDDM, Fitting, CNN) shows charge resolution between integration. 

% Pedestal & Hardware

We do not evaluate the pedestal of waveforms in this work, which is a potential future work to do. Additionally, widely equipped PMTs bring the data storage pressure. A voltage data pre-process hardware can solve this problem with waveform analysis, equivalent to or even more effective than data compression, which is also a prospective work. 
