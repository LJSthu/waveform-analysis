\section{Introduction} % (fold)
\label{sec:Introduction}
PMT is involved in many neutrino and dark matter experiments. Traditionally, waveform within a period of time is integrated when the voltage exceed a certain threshold to obtain charge, such as Borexino\cite{lagomarsino_gateless_1999}, SNO\cite{dunger_event_2019} and XMASS\cite{abe_xmass_2013}. Meanwhile the first hittime of each PMT is also recorded. Other experiment employed some simple programs including Fourier deconvolution to extract charge and hittime for each photoelectron, such as Daya Bay\cite{huang_flash_2018}, KamLAND\cite{the_kamland_collaboration_production_2010}, JUNO\cite{zhang_comparison_2019} and XENON1T\cite{aprile_xenon1t_2019}. The efforts exerted on waveform analysis in these experiments is limited by amount of stored data and computational efficiency. 

Extracting the information of time and number of photons hitting will provide more detailed information of light transmit model in detector and will finally enhance the performance of event reconstruction, even particle identification. 

A toy MC has been developed to demonstrate the time resolution improve induced by detailed waveform analysis. We assume the time profile of the liquid scintillator is an exponential function convoluted by a gaussian function\cite{li_separation_2016} caused by the transit time spread of PMT, with the form in the formula \eqref{eq:time-pro}. 

\begin{equation}
    f(t) = \frac{1}{\tau}e^{-\frac{t - t_{0}}{\tau}} \otimes \mathcal{N}(\sigma)
    \label{eq:time-pro}
\end{equation}

The number of PE ($N_{pe}$) in a waveform is sampled from a Poisson distribution with expectation $\mu$. We used Maximum Likelihood Estimation (MLE) to estimate $t_{0}$ in formula\eqref{eq:time-pro}, which is the rise time of the time profile. The typical combination of decay time ($\tau$) and transit time spread ($\sigma$) are listed in figure (see figure~\ref{fig:reso-diff}). For every PE expectation $\mu$, a sample set (size $N=10,000$) is generated to estimate the time resolution $\delta$, which is the residual ($\Delta t_{0}$) distribution spread. 

The result of the toy MC shows in figure~\ref{fig:reso-diff}, where $\delta_{1st}$ and $\delta_{all}$ are time resolution when using the first PE and all PE, respectively.  Error bars are too thin to be seen. It is distinct that the time resolution is smaller when reconstructing rise time using all PE. 

\begin{figure}[H]
    \centering
    \scalebox{0.35}{\input{figures/vs-deltasub.pgf}}
    \caption{\label{fig:reso-diff} Time resolution improved of waveform analysis}
\end{figure}

Therefore PMT waveform analysis is necessary when we pursue completely usage of PMT output. 

\paragraph{Notations}
\begin{itemize}
    \item $t$ - Time of waveform
    \item $t_{H}$ - Hittime, time of PE hitting first dynode
    \item $v_{w}(t)$ - Pedestal reduced origin waveform voltage
    \item $v_{spe}(t)$ - Single-photoelectron (SPE) response
    \item $v_{th}$ - Voltage threshold
    \item $q_{r}(t_{H})$ - Reconstructed charge
    \item $n_{r}(t_{H})$ - Reconstructed number of PE (\#PE)
    \item $v_{r}(t)$ - Reconstructed waveform
    \item $Q$ - Total Charge in a DAQ window
    \item $N_{pe}$ - Total PE number in a DAQ window
    \item $N_{pos}$ - Total number of hittime in a DAQ window
    \item $W_{d}$ - Wasserstein distance
\end{itemize}
The $t$ and $t_{H}$ we defined here is discrete value in 1 DAQ window (from 0 to 1029ns, step size is 1ns in Jinping 1ton prototype DAQ system). Therefore $N_{pos}$ is not equal to $N_{pe}$ ($N_{pe} \geq N_{pos}$). 
% section Introduction (end)